<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sri Thirumala Drip Irrigation — Invoice</title>
  <style>
    :root { --brand:#2980b9; --dark:#2c3e50; }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background:#f4f4f9; color:#222; margin:0; padding:20px;
    }
    header { text-align:center; margin-bottom:18px; }
    header h1 { margin:0; color:var(--dark); font-size:28px; }
    .top-row { display:flex; gap:12px; flex-wrap:wrap; justify-content:space-between; margin:14px 0; }
    .top-row .field { flex:1; min-width:170px; text-align:center; }
    .top-row input[type="text"], .top-row input[type="tel"] {
      width:72%; padding:8px; border:2px solid var(--dark); border-radius:6px; font-size:14px;
    }
    #invoice-area {
      background:white; padding:16px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.06);
    }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    th, td { border:1px solid var(--dark); padding:10px; text-align:center; font-size:14px; }
    th { background:var(--brand); color:white; }
    input.quantity, input.price { width:70px; padding:6px; }
    input.item-name { width:95%; padding:6px; }
    .action-btn { background:var(--brand); color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; }
    .action-btn:hover { background:#21618c; }
    .row-del { background:#e74c3c; border:none; color:white; padding:6px 8px; border-radius:6px; cursor:pointer; }
    .row-del:hover { opacity:0.9; }
    #total-summary { text-align:right; margin-top:10px; font-weight:700; }
    #controls { display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    .history { margin-top:14px; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    select { padding:8px; border-radius:6px; border:1px solid #ccc; }
    @media print {
      #controls, .history, #add-row, #save-invoice, #whatsapp-share { display:none !important; }
      input, button { border:none !important; }
      th:last-child, td:last-child { display:none !important; } /* Hide remove column */
      input { outline:none; }
      body { margin: 20px; background:white; }
      .top-row input { border:none; }
    }
  </style>
</head>
<body>

  <header>
    <h1>Sri Thirumala Drip Irrigation</h1>
  </header>

  <div class="top-row">
    <div class="field">Name:<br><input type="text" id="customer-name" placeholder="Enter customer name"></div>
    <div class="field">Phone:<br><input type="tel" id="customer-phone" placeholder="Enter phone number"></div>
    <div class="field">Invoice #:<br><input type="text" id="invoice-no"></div>
    <div class="field">Date:<br><span id="current-date"></span></div>
  </div>

  <div id="invoice-area">
    <table id="items-table">
      <thead>
        <tr>
          <th style="width:40%;">Items</th>
          <th style="width:12%;">Quantity</th>
          <th style="width:16%;">Price (₹)</th>
          <th style="width:18%;">Total Price (₹)</th>
          <th style="width:14%;">Action</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <input list="item-names" class="item-name" placeholder="Start typing item name">
            <datalist id="item-names">
              <option value="Drip Pipes">
              <option value="Sprinklers">
              <option value="Fittings">
              <option value="Valves">
              <option value="Filters">
            </datalist>
          </td>
          <td><input class="quantity" type="number" min="1" value="1"></td>
          <td><input class="price" type="number" min="0" step="0.01" value="0"></td>
          <td class="total-price">0.00</td>
          <td><button class="row-del" title="Remove row">Remove</button></td>
        </tr>
      </tbody>
    </table>

    <div id="total-summary">
      Total Items: <span id="total-items">1</span> |
      Total Quantity: <span id="total-quantity">1</span> |
      Total Cost: ₹<span id="total-cost">0.00</span>
    </div>

    <div style="margin-top:18px;">Signature: ________________________</div>
  </div>

  <div id="controls">
    <button id="add-row" class="action-btn">Add Row</button>
    <button id="print-button" class="action-btn">Print</button>
    <button id="whatsapp-share" class="action-btn">Share on WhatsApp</button>
  </div>

  <script>
    document.getElementById('current-date').textContent = new Date().toLocaleDateString();
    const tableBody = document.querySelector('#items-table tbody');
    const invoiceNoEl = document.getElementById('invoice-no');
    invoiceNoEl.value = 'INV-' + Date.now().toString().slice(-6);

    function updateTotals() {
      const rows = Array.from(tableBody.rows);
      let totalItems = rows.length, totalQty = 0, totalCost = 0;
      rows.forEach(r => {
        const q = parseFloat(r.querySelector('.quantity').value) || 0;
        const p = parseFloat(r.querySelector('.price').value) || 0;
        const t = q * p;
        r.querySelector('.total-price').textContent = t.toFixed(2);
        totalQty += q; totalCost += t;
      });
      document.getElementById('total-items').textContent = totalItems;
      document.getElementById('total-quantity').textContent = totalQty;
      document.getElementById('total-cost').textContent = totalCost.toFixed(2);
    }
    updateTotals();

    document.getElementById('add-row').addEventListener('click', () => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input list="item-names" class="item-name" placeholder="Start typing item name"></td>
        <td><input class="quantity" type="number" min="1" value="1"></td>
        <td><input class="price" type="number" min="0" step="0.01" value="0"></td>
        <td class="total-price">0.00</td>
        <td><button class="row-del">Remove</button></td>`;
      tableBody.appendChild(tr);
      updateTotals();
    });

    tableBody.addEventListener('click', e => {
      if (e.target.classList.contains('row-del')) {
        if (tableBody.rows.length > 1) e.target.closest('tr').remove();
        else e.target.closest('tr').querySelectorAll('input').forEach(i=>i.value='');
        updateTotals();
      }
    });
    tableBody.addEventListener('input', updateTotals);

    // Build printable invoice content
    function buildPrintableHTML() {
      const shop = "Sri Thirumala Drip Irrigation";
      const name = document.getElementById('customer-name').value;
      const phone = document.getElementById('customer-phone').value;
      const inv = document.getElementById('invoice-no').value;
      const date = document.getElementById('current-date').textContent;
      let html = `
        <h1 style="text-align:center;">${shop}</h1>
        <p><strong>Customer:</strong> ${name} &nbsp;&nbsp; 
           <strong>Phone:</strong> ${phone} &nbsp;&nbsp;
           <strong>Invoice #:</strong> ${inv} &nbsp;&nbsp;
           <strong>Date:</strong> ${date}</p>
        <table style="width:100%; border-collapse:collapse;" border="1">
          <thead><tr>
            <th>Item</th><th>Qty</th><th>Price (₹)</th><th>Total (₹)</th>
          </tr></thead><tbody>`;
      Array.from(tableBody.rows).forEach(r=>{
        const i=r.querySelector('.item-name').value;
        const q=r.querySelector('.quantity').value;
        const p=r.querySelector('.price').value;
        const t=r.querySelector('.total-price').textContent;
        html+=`<tr><td>${i}</td><td>${q}</td><td>${p}</td><td>${t}</td></tr>`;
      });
      const total=document.getElementById('total-cost').textContent;
      html+=`</tbody></table><h3 style="text-align:right;">Total: ₹${total}</h3>`;
      return html;
    }

    document.getElementById('print-button').addEventListener('click',()=>{
      const html=buildPrintableHTML();
      const w=window.open('','_blank');
      w.document.write('<html><head><title>Invoice</title></head><body>'+html+'</body></html>');
      w.document.close(); w.print();
    });

    document.getElementById('whatsapp-share').addEventListener('click',()=>{
      const phone=document.getElementById('customer-phone').value.trim();
      if(!phone){alert('Enter phone number');return;}
      const name=document.getElementById('customer-name').value;
      const inv=document.getElementById('invoice-no').value;
      const total=document.getElementById('total-cost').textContent;
      const msg=`*Sri Thirumala Drip Irrigation*\nInvoice#: ${inv}\nCustomer: ${name}\nTotal: ₹${total}\n\nPlease find attached invoice PDF.`;
      const url=`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
      const html=buildPrintableHTML();
      const w=window.open('','_blank');
      w.document.write('<html><body>'+html+'</body></html>');
      w.document.close(); w.print();
      setTimeout(()=>window.open(url,'_blank'),800);
    });
  </script>
</body>
</html>
